:root {
  --bg: #0b1220;
  --fg: #e8eefc;

  --wrap-max: 980px;

  /* spazi fissi dai bordi */
  --pad-x: 14px;
  --pad-top: 14px;
  --pad-bottom: 14px;

  /* stime altezze header e controlli */
  --top-h: 84px;
  --controls-h: 190px;

  /* limiti viewport di gioco */
  --world-min-h: 320px;
  --world-max-h: 78svh;

  --world-radius: 18px;

  --joy-size: 140px;
  --joy-knob: 56px;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  overflow: hidden;
}

body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: var(--bg);
  color: var(--fg);
  display: grid;
  place-items: start center;
  min-height: 100vh;
  min-height: 100svh;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: auto;
}

.wrap {
  width: min(var(--wrap-max), 94vw);
  padding-left: calc(var(--pad-x) + env(safe-area-inset-left));
  padding-right: calc(var(--pad-x) + env(safe-area-inset-right));
  padding-top: calc(var(--pad-top) + env(safe-area-inset-top));
  padding-bottom: calc(var(--pad-bottom) + env(safe-area-inset-bottom));
  min-height: 100vh;
  min-height: 100svh;
  display: flex;
  flex-direction: column;
}

.top {
  display: flex;
  justify-content: center;
  text-align: center;
  margin: 0;
  min-height: var(--top-h);
  align-items: center;
}

.title {
  font-size: 28px;
  font-weight: 700;
}

.subtitle {
  margin-top: 6px;
  font-size: 26px;
}

.world {
  position: relative;
  width: 100%;
  border-radius: var(--world-radius);
  overflow: hidden;
  outline: none;
  box-shadow: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: none;
  height: clamp(
    var(--world-min-h),
    calc(100svh - (var(--pad-top) + var(--pad-bottom)) - var(--top-h) - var(--controls-h) - env(safe-area-inset-top) - env(safe-area-inset-bottom)),
    var(--world-max-h)
  );
}

.world:focus,
.world:focus-visible,
.world:active {
  outline: none;
  box-shadow: none;
}

.scene {
  position: absolute;
  left: 0;
  top: 0;
  transform-origin: 0 0;
}

.npc-counter {
  position: absolute;
  left: 12px;
  bottom: 12px;
  z-index: 99999;

  background: transparent;
  padding: 0;

  font-size: clamp(28px, 3.5vw, 36px);
  font-weight: 900;
  color: #ff2a2a;

  text-shadow:
    -2px -2px 0 #000,
     2px -2px 0 #000,
    -2px  2px 0 #000,
     2px  2px 0 #000,
     0px  2px 0 #000,
     2px  0px 0 #000,
    -2px  0px 0 #000,
     0px -2px 0 #000;

  pointer-events: none;
  display: none;
}

.start-gate {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
  z-index: 999999;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.start-gate__label {
  font-size: clamp(48px, 10vw, 120px);
  font-weight: 900;
  letter-spacing: 0.08em;
  color: #fff;
}

.start-gate.hidden {
  display: none;
}

.bg,
.fg {
  position: absolute;
  left: 0;
  top: 0;
  pointer-events: none;
  user-select: none;
  -webkit-user-drag: none;
}

.bg { z-index: 0; }
.fg { z-index: 40; }

.entity {
  position: absolute;
  display: grid;
  place-items: center;
  user-select: none;
  z-index: 10;
}

.entity[data-id="player"] {
  z-index: 30;
}

.entity.npc {
  z-index: 60;
}

.entity__fx {
  width: 100%;
  height: 100%;
  display: grid;
  place-items: center;
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}

.entity.active {
  transform: scale(1.2);
  z-index: 80;
}

.entity img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
  user-select: none;
  -webkit-user-drag: none;
}

.entity__fx img {
  transform: translateZ(0);
  backface-visibility: hidden;
}

@keyframes npc-bounce-squash {
  0% { transform: translate3d(0, 0, 0) scaleX(1.04) scaleY(0.96); }
  15% { transform: translate3d(0, -2px, 0) scaleX(1.01) scaleY(0.99); }
  30% { transform: translate3d(0, -4px, 0) scaleX(0.97) scaleY(1.03); }
  50% { transform: translate3d(0, -6px, 0) scaleX(0.92) scaleY(1.08); }
  70% { transform: translate3d(0, -4px, 0) scaleX(0.97) scaleY(1.03); }
  85% { transform: translate3d(0, -2px, 0) scaleX(1.01) scaleY(0.99); }
  100% { transform: translate3d(0, 0, 0) scaleX(1.04) scaleY(0.96); }
}

.entity.npc .entity__fx {
  animation: npc-bounce-squash 1.55s cubic-bezier(0.22, 0.61, 0.36, 1) infinite;
  animation-delay: var(--bounce-delay, 0s);
}

.entity.npc.active .entity__fx {
  animation: none;
}

@media (prefers-reduced-motion: reduce) {
  .entity.npc .entity__fx {
    animation: none;
  }
}

.controls {
  min-height: var(--controls-h);
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 12px;
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
}

.joy {
  width: var(--joy-size);
  height: var(--joy-size);
  border-radius: 999px;
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(8px);
  position: relative;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
}

.joy__knob {
  width: var(--joy-knob);
  height: var(--joy-knob);
  border-radius: 999px;
  background: rgba(255,255,255,0.22);
  border: 1px solid rgba(255,255,255,0.22);
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}

.bubble {
  position: absolute;
  left: 50%;
  top: 0px;
  transform: translate(-50%, -100%);
  z-index: 9999;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: max-content;
  max-width: 280px;
  min-width: 80px;
}

.bubble__box {
  background: #ffffff;
  color: #0b1220;
  border-radius: 16px;
  padding: 10px 12px;
  font-size: 13px;
  line-height: 1.35;
  white-space: normal;
  overflow-wrap: anywhere;
  box-shadow: 0 10px 24px rgba(0,0,0,0.22);
}

.bubble__box code{
  color:#777676;
  background:#e8eefc;
  border:1px solid rgba(11,18,32,0.30);
  padding:2px 6px;
  border-radius:7px;
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:0.95em;
  white-space:nowrap;
}

.bubble__tail {
  width: 0;
  height: 0;
  margin-top: -2px;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 12px solid #ffffff;
}

@media (min-width: 900px) and (pointer: fine) {
  .controls {
    display: none;
  }

  :root {
    --controls-h: 0px;
  }
}

@media (max-width: 520px) {
  :root {
    --top-h: 72px;
    --controls-h: 180px;
  }

  .title { font-size: 22px; }
  .subtitle { font-size: 22px; margin-top: 4px; }
}

.splash {
  position: fixed;
  inset: 0;
  z-index: 99999;

  display: flex;
  align-items: center;
  justify-content: center;

  background: #0b1220;

  padding:
    env(safe-area-inset-top)
    env(safe-area-inset-right)
    env(safe-area-inset-bottom)
    env(safe-area-inset-left);

  user-select: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  cursor: pointer;
}

.splash__img {
  max-width: 92vw;
  max-height: 92svh;
  width: auto;
  height: auto;
  display: block;

  pointer-events: none;
  -webkit-user-drag: none;
}

.splash__hint {
  position: absolute;
  left: 50%;
  bottom: calc(150px + env(safe-area-inset-bottom));
  transform: translateX(-50%);

  padding: 14px 20px;
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.45);
  color: #fff;
  font-size: 20px;
  letter-spacing: 0.4px;
  font-weight: 600;
  pointer-events: none;

  width: max-content;
  max-width: calc(100vw - 32px);
  white-space: nowrap !important;
  line-height: 1.1;
  -webkit-text-size-adjust: 100%;
}

.splash.hide {
  opacity: 0;
  transition: opacity 220ms ease;
}
